# The Three Musketeers Learning
**Timestamp**: 2026-01-01_18-59-48  
**Classification**: KNOWLEDGE  
**Primary Agent**: oracle-hybrid

## Task
The 3 Musketeers: Force-enable Thunderbolt Networking on a Windows 11 Notebook (Meteor Lake) and Proxmox (Meteor Lake) specifically for peer-to-peer 10.0.0.x. 1. PowerShell commands for Windows. 2. Linux commands for Proxmox.

## Result
# The 3 Musketeers: Force-Enable Thunderbolt Networking

> **Peer-to-Peer 10.0.0.x Network** between Windows 11 â†” Proxmox (Both Meteor Lake)

---

## ğŸ¯ Overview

Thunderbolt Networking (TBT Net) creates a **40Gbps virtual ethernet** connection over Thunderbolt cable. Meteor Lake includes Thunderbolt 4 controllers that support this natively.

---

## 1ï¸âƒ£ Windows 11 (PowerShell - Admin)

### Step 1: Enable Thunderbolt Networking Driver

```powershell
# Check if Thunderbolt controller is present
Get-PnpDevice -Class "System" | Where-Object { $_.FriendlyName -match "Thunderbolt" }

# Force enable Thunderbolt Networking adapter (if disabled)
Get-NetAdapter -Name "*Thunderbolt*" | Enable-NetAdapter -Confirm:$false

# If adapter doesn't appear, force scan for hardware changes
pnputil /scan-devices

# Install Thunderbolt Networking if missing (Intel driver)
# Download from Intel first, then:
pnputil /add-driver "C:\Path\To\ThunderboltNetworking.inf" /install
```

### Step 2: Configure Static IP (10.0.0.x)

```powershell
# Find Thunderbolt Network adapter name
$adapter = Get-NetAdapter | Where-Object { $_.InterfaceDescription -match "Thunderbolt" }

# Set static IP
New-NetIPAddress -InterfaceIndex $adapter.ifIndex `
    -IPAddress 10.0.0.1 `
    -PrefixLength 24 `
    -DefaultGateway $null

# Disable DHCP on this adapter
Set-NetIPInterface -InterfaceIndex $adapter.ifIndex -Dhcp Disabled

# Verify configuration
Get-NetIPAddress -InterfaceIndex $adapter.ifIndex
```

### Step 3: Firewall Rules for Peer-to-Peer

```powershell
# Allow all traffic on 10.0.0.0/24 subnet
New-NetFirewallRule -DisplayName "Thunderbolt P2P" `
    -Direction Inbound `
    -LocalAddress 10.0.0.0/24 `
    -Action Allow `
    -Profile Any

New-NetFirewallRule -DisplayName "Thunderbolt P2P Out" `
    -Direction Outbound `
    -RemoteAddress 10.0.0.0/24 `
    -Action Allow `
    -Profile Any
```

### Step 4: Force Thunderbolt Authorization (If Blocked)

```powershell
# Set Thunderbolt security to "No Security" (allows all devices)
# WARNING: Reduces DMA protection
reg add "HKLM\SYSTEM\CurrentControlSet\Services\TbtHostController\IntelThunderboltNvm" `
    /v "SecurityLevel" /t REG_DWORD /d 0 /f

# Restart Thunderbolt service
Restart-Service -Name "ThunderboltService" -Force
```

---

## 2ï¸âƒ£ Proxmox (Linux Commands)

### Step 1: Load Thunderbolt Networking Module

```bash
# Check Thunderbolt controller
lspci | grep -i thunderbolt

# Load thunderbolt-net module
modprobe thunderbolt-net

# Make persistent across reboots
echo "thunderbolt-net" >> /etc/modules-load.d/thunderbolt.conf

# Verify module loaded
lsmod | grep thunderbolt
```

### Step 2: Authorize Thunderbolt Device

```bash
# List Thunderbolt devices
ls /sys/bus/thunderbolt/devices/

# Find the connected device (e.g., 0-1)
cat /sys/bus/thunderbolt/devices/0-1/device_name

# Authorize the device (force enable)
echo 1 > /sys/bus/thunderbolt/devices/0-1/authorized

# For auto-authorization (less secure)
echo 1 > /sys/bus/thunderbolt/devices/domain0/security
```

### Step 3: Find and Configure Network Interface

```bash
# After authorization, new interface appears (thunderbolt0 or similar)
ip link show | grep -E "thunderbolt|enp.*s0"

# The interface usually named like: enp0s10f0, enp196s0, or thunderbolt0
# Find it:
dmesg | grep -i "thunderbolt" | tail -20

# Bring interface up
ip link set thunderbolt0 up  # or your interface name
```

### Step 4: Configure Static IP (10.0.0.x)

```bash
# Temporary (test first)
ip addr add 10.0.0.2/24 dev thunderbolt0
ip link set thunderbolt0 up

# Verify
ip addr show thunderbolt0
```

### Step 5: Persistent Configuration (Proxmox/Debian)

```bash
# Edit network interfaces
cat >> /etc/network/interfaces << 'EOF'

# Thunderbolt Networking P2P
auto thunderbolt0
iface thunderbolt0 inet static
    address 10.0.0.2
    netmask 255.255.255.0
EOF

# Apply changes
ifreload -a
# or
systemctl restart networking
```

### Step 6: Thunderbolt Security Policy (Optional)

```bash
# Check current security level
cat /sys/bus/thunderbolt/devices/domain0/security

# Options: none, user, secure, dponly
# For easy P2P, set to 'none' (WARNING: disables DMA protection)
echo "none" > /sys/bus/thunderbolt/devices/domain0/security

# Make persistent via kernel parameter
# Edit /etc/default/grub:
# GRUB_CMDLINE_LINUX="thunderbolt.security=none"
update-grub
```

---

## 3ï¸âƒ£ Testing the Connection

### From Windows:
```powershell
ping 10.0.0.2
Test-NetConnection -ComputerName 10.0.0.2 -Port 22
```

### From Proxmox:
```bash
ping 10.0.0.1
iperf3 -s  # Start server for speed test
```

### Speed Test (Windows â†’ Proxmox):
```powershell
# Install iperf3 on Windows, then:
iperf3.exe -c 10.0.0.2
```

**Expected**: 20-40 Gbps throughput

---

## âš ï¸ Troubleshooting

| Issue | Windows Fix | Linux Fix |
|-------|-------------|-----------|
| No adapter appears | `pnputil /scan-devices` | `modprobe thunderbolt-net` |
| Device not authorized | Check Thunderbolt Control Panel | `echo 1 > .../authorized` |
| Link but no IP | Check firewall | `ip link set <dev> up` |
| Slow speed | Disable power saving | `ethtool -K <dev> tso on gso on` |

---

## ğŸ”’ Security Note

Setting Thunderbolt security to "none" disables DMA attack protection. For trusted peer-to-peer only. In production, use `user` security level and manually approve devices.

---

**The 3 Musketeers**:
1. ğŸ—¡ï¸ **Athos** = Windows PowerShell (Enable + Configure)
2. ğŸ—¡ï¸ **Porthos** = Linux modprobe + ip (Force load + Network)
3. ğŸ—¡ï¸ **Aramis** = Authorization (Security bypass for P2P)
---
*Elevated by Oracle/Codex/Claude System*
